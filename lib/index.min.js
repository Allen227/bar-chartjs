!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(t=t||self).BarChart=i()}(this,function(){"use strict";function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function t(t){return function(t){if(Array.isArray(t)){for(var i=0,e=new Array(t.length);i<t.length;i++)e[i]=t[i];return e}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var u={data:[],labels:[],margin:{top:30,bottom:30},xAxis:{font:{size:13,family:"Arial",style:"#333"},line:{style:"#333",width:1},tick:{style:"#333",width:1,length:6}},yAxis:{font:{size:13,family:"Arial",style:"#333"},line:{style:"#333",width:1},tick:{style:"#333",width:1,length:6}},guideLine:{style:"#ccc",width:1},bar:{style:{default:"rgba(16, 142, 233, 0.6)",select:"rgb(16, 142, 233)"}},style:{axis:"#aaa",line:"#ccc"},duration:500,tooltip:{title:"",style:"rgba(0, 0, 0, 0.6)",height:50,radius:4,mark:{radius:5,style:"rgb(16, 142, 233)"},font:{size:14,family:"Arial",style:"rgba(0, 0, 0, 0.6)"}}},r=["x","y","w","h"];function n(t){var i=t.context,e=t.tick,n=t.yAxis_left,o=t.areaW,a=t.areaH;!function(t,i,e,n){t.beginPath(),t.strokeStyle=u.yAxis.line.style,t.lineWidth=u.yAxis.line.width,t.moveTo(i,u.margin.top),t.lineTo(i,n),t.stroke(),t.beginPath(),t.strokeStyle=u.xAxis.line.style,t.lineWidth=u.xAxis.line.width,t.moveTo(i,n),t.lineTo(e+i,n),t.stroke()}(i,n,o,a),function(t,i,e,n){var o=u.labels,a=e/(o.length+1),r=u.xAxis.tick.length;t.beginPath(),t.strokeStyle=u.xAxis.font.style,t.textAlign="center",t.font="".concat(u.xAxis.font.size,"px ").concat(u.xAxis.font.family),t.fillStyle=u.xAxis.font.style;for(var s=1;s<=o.length;s++)t.moveTo(i+s*a,n),t.lineTo(i+s*a,n+r),t.fillText(o[s-1],i+s*a,n+20);t.closePath(),t.stroke()}(i,n,o,a),function(t,i,e,n,o){var a=(o-u.margin.top)/i[3],r=u.yAxis.tick.length;t.textBaseline="middle",t.textAlign="right",t.font="".concat(u.yAxis.font.size,"px ").concat(u.yAxis.font.family),t.fillStyle=u.yAxis.font.style;for(var s=0;s<=i[3];s++)t.beginPath(),t.fillText(i[2]*s,e-10,o-s*a),t.strokeStyle=u.yAxis.tick.style,t.lineWidth=u.yAxis.tick.width,t.moveTo(e-r,o-s*a),t.lineTo(e,o-s*a),t.closePath(),t.stroke(),0!==s&&(t.beginPath(),t.strokeStyle=u.guideLine.style,t.lineWidth=u.guideLine.width,t.moveTo(e,o-s*a),t.lineTo(n+e,o-s*a),t.closePath(),t.stroke())}(i,e,n,o,a)}var o={isObject:function(t){return"object"===i(t)&&"[object Object]"===Object.prototype.toString.call(t)},formatTick:function(){var c=[];return function(t,i,e){if(!arguments.length)return c;!function(t,i,e){var n,o,a,r,s=(i-t)/e,l=Math.log10(s);o=0<=(o=(s/(n=Math.pow(10,parseInt(l))===s?Math.pow(10,parseInt(l)):Math.pow(10,parseInt(l+1)))).toFixed(6))&&o<=.1?.1:.100001<=o&&o<=.2?.2:.200001<=o&&o<=.25?.25:.250001<=o&&o<=.5?.5:1,o*=n,parseInt(t/o)!==t/o&&(t=parseInt(t/o)*o),parseInt(i/o)!==i/o&&(i=(parseInt(i/o)+1)*o),(r=(i-t)/o)<e&&(i+=!(a=e-r)%2?o*parseInt(a/2):o*parseInt(a/2+1),t-=o*parseInt(a/2)),c.push([t,i,o,e])}(t,i,e)}},getSuitableStep:function(t,i){for(var e=this.formatTick(),n=10;5<=n;n--)e(t,i,n);var o,a=e(),r=Number.MAX_VALUE;return a.forEach(function(t,i){t[1]<=r&&(r=t[1],o=i)}),a[o]},getTick:function(t,i){return this.getSuitableStep(t,i)},requestAnimationFrame:function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return window.setTimeout(t,1e3/60)}}};function e(t){throw t}function a(t,i){this instanceof a||e(new Error('BarChart is constructor, should be involed with "new" operator!')),this._init(t,i)}return a.prototype._init=function(t,i){this.initContext(t),this.initOption(i),this.initData(),this.caculateScele(),this.initBars(),this.initEvent(t),this.render()},a.prototype.initEvent=function(t){var i=this,e=Object.create(null);t.addEventListener("mousemove",function(){e.x=event.clientX-i.boundingRect.left,e.y=event.clientY-i.boundingRect.top,clearTimeout(t);var t=setTimeout(function(){i.context.clearRect(0,0,i.canvasW,i.canvasH),n(i),i.drawBars(e)},1e3/60)})},a.prototype.initData=function(){this.animQuota=0,this.min_data=Math.min.apply(Math,t(u.data)),this.max_data=Math.max.apply(Math,t(u.data))},a.prototype.initContext=function(t){this.boundingRect=t.getBoundingClientRect(),t.nodeType===Node.ELEMENT_NODE&&"CANVAS"===t.nodeName?(this.canvasW=t.width,this.canvasH=t.height,this.context=t.getContext("2d")):e(new Error("Context should be a canvas DOM"))},a.prototype.initOption=function(t){!function i(e,n){Object.keys(e).forEach(function(t){e[t]&&!o.isObject(e[t])?n[t]=e[t]:o.isObject(e[t])&&i(e[t],n[t])})}(t,u)},a.prototype.initBars=function(){var n=this;this.bars=[],this.phyScale=(this.areaH-u.margin.top)/this.tick[1];var o=this.areaW/(u.data.length+1)/2,a=1.5*o;u.data.forEach(function(t,i){var e=function(){var e=Object.create(null),n=arguments;return r.forEach(function(t,i){e[t]=n[i]}),e}(a+n.yAxis_left,n.areaH,o,-1*t*n.phyScale);n.bars.push(e),a+=2*o})},a.prototype.caculateScele=function(){this.tick=o.getTick(0<=this.min_data?0:this.min_data,this.max_data),this.context.font="".concat(u.yAxis.font.size," ").concat(u.yAxis.font.size),this.yAxis_left=parseInt(2*this.context.measureText(this.tick[1]).width),this.areaW=this.canvasW-this.yAxis_left,this.areaH=this.canvasH-u.margin.bottom},a.prototype.render=function(){this.context.translate(.5,.5),n(this),this.animation()},a.prototype.drawBars=function(e){var n=this,o=-1;n.bars.forEach(function(t,i){e&&e.x>=t.x&&e.x<=t.x+t.w&&e.y<=t.y&&e.y>=t.y+t.h&&(o=i),function(t,i,e){t.fillStyle=e?u.bar.style.select:u.bar.style.default,t.fillRect(i.x,i.y,i.w,i.h)}(n.context,t,!1)}),~o&&function(t,i,e){var n=u.tooltip.mark.radius,o="".concat(u.tooltip.title).concat(u.data[e]);t.font="".concat(u.tooltip.font.size,"px ").concat(u.tooltip.font.family);var a=t.measureText(o).width,r=t.measureText(u.labels[e]).width,s=r<a?a:r;s+=3*n;var l=u.tooltip.radius,c=u.tooltip.height,h=i.x+10,f=i.y+10,y=[{x:h,y:f},{x:h+s+12,y:f},{x:h+s+12,y:f+c},{x:h,y:f+c}];t.beginPath(),t.fillStyle=u.tooltip.style,t.lineJoin="round",t.moveTo(y[0].x+u.tooltip.radius,y[0].y),t.arcTo(y[1].x,y[1].y,y[2].x,y[2].y,l),t.arcTo(y[2].x,y[2].y,y[3].x,y[3].y,l),t.arcTo(y[3].x,y[3].y,y[0].x,y[0].y,l),t.arcTo(y[0].x,y[0].y,y[1].x,y[1].y,l),t.fill(),t.beginPath(),t.fillStyle="#fff",t.textAlign="left",t.textBaseline="middle",t.fillText(u.labels[e],h+6,f+.85*c/3),t.fillText(o,h+6+3*n,f+2.1*c/3),t.closePath(),t.stroke(),t.beginPath(),t.fillStyle=u.tooltip.mark.style,t.arc(h+6+n,f+2*c/3,n,0,2*Math.PI),t.fill()}(n.context,e,o)},a.prototype.animation=function(){var t=this.context,i=this.max_data*this.phyScale/(.001*u.duration*60);if(t.clearRect(0,0,this.canvasW,this.canvasH),t.save(),n(this),this.animQuota-=i,t.rect(0,this.canvasH-u.margin.bottom,this.canvasW,this.animQuota),t.clip(),this.drawBars(),this.animQuota>-1*this.max_data*this.phyScale){var e=this.animation.bind(this);o.requestAnimationFrame()(e)}t.restore()},a});