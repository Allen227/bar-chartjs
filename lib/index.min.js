!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).BarChart=e()}(this,function(){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function t(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var c={xAxis:{font:{size:13,family:"Arial",style:"#333"},line:{style:"#333",width:1}},yAxis:{font:{size:13,family:"Arial",style:"#333"},line:{style:"#aaa",width:1}},bar:{style:{default:"rgba(16, 142, 233, 0.6)",select:"rgb(16, 142, 233)"}},style:{axis:"#aaa",line:"#ccc"},duration:2e3,tooltip:{radius:4,font:{size:14,family:"Arial",style:"rgba(0, 0, 0, 0.6)"}},data:[],labels:[]},s=["x","y","w","h"];function i(t){var e=t.context,n=t.tick,i=t.canvasW,o=t.canvasH,a=t.yAxis_left;!function(t,e,n,i){t.beginPath(),t.strokeStyle=c.yAxis.line.style,t.moveTo(e,0),t.lineTo(e,i-20),t.closePath(),t.stroke()}(e,a,0,o),function(t,e,n,i){var o=c.labels,a=(n-e)/(o.length+1),r=i-26;t.beginPath(),t.strokeStyle=c.xAxis.font.style,t.textAlign="center",t.font="".concat(c.xAxis.font.size,"px ").concat(c.xAxis.font.family),t.fillStyle=c.xAxis.font.style;for(var s=1;s<=o.length;s++)t.moveTo(e+s*a,r),t.lineTo(e+s*a,6+r),t.fillText(o[s-1],e+s*a,20+r);t.closePath(),t.stroke()}(e,a,i,o),function(t,e,n,i,o){var a=(o-40)/e[3],r=o-26;t.beginPath(),t.strokeStyle=c.yAxis.line.style,t.textBaseline="middle",t.textAlign="right",t.font="".concat(c.yAxis.font.size,"px ").concat(c.yAxis.font.family),t.fillStyle=c.yAxis.font.style;for(var s=0;s<=e[3];s++)t.fillText(e[2]*s,n-10,r-s*a),t.moveTo(n-6,r-s*a),t.lineTo(n,r-s*a),t.moveTo(n,r-s*a),t.lineTo(i,r-s*a);t.closePath(),t.stroke()}(e,n,a,i,o)}var o={isObject:function(t){return"object"===e(t)&&"[object Object]"===Object.prototype.toString.call(t)},formatTick:function(){var l=[];return function(t,e,n){if(!arguments.length)return l;!function(t,e,n){var i,o,a,r,s=(e-t)/n,c=Math.log10(s);o=0<=(o=(s/(i=Math.pow(10,parseInt(c))===s?Math.pow(10,parseInt(c)):Math.pow(10,parseInt(c+1)))).toFixed(6))&&o<=.1?.1:.100001<=o&&o<=.2?.2:.200001<=o&&o<=.25?.25:.250001<=o&&o<=.5?.5:1,o*=i,parseInt(t/o)!==t/o&&(t=parseInt(t/o)*o),parseInt(e/o)!==e/o&&(e=(parseInt(e/o)+1)*o),(r=(e-t)/o)<n&&(e+=!(a=n-r)%2?o*parseInt(a/2):o*parseInt(a/2+1),t-=o*parseInt(a/2)),l.push([t,e,o,n])}(t,e,n)}},getSuitableStep:function(t,e){for(var n=this.formatTick(),i=10;5<=i;i--)n(t,e,i);var o,a=n(),r=Number.MAX_VALUE;return a.forEach(function(t,e){t[1]<=r&&(r=t[1],o=e)}),a[o]},getTick:function(t,e){return this.getSuitableStep(t,e)},requestAnimationFrame:function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return window.setTimeout(t,1e3/60)}}};function n(t){throw t}function a(t,e){this instanceof a||n(new Error('BarChart is constructor, should be involed with "new" operator!')),this._init(t,e)}return a.prototype._init=function(t,e){this.initContext(t),this.initOption(e),this.initData(),this.caculateScele(),this.initBars(),this.initEvent(t),this.render()},a.prototype.initEvent=function(t){var e=this,n=Object.create(null);t.addEventListener("mousemove",function(){n.x=event.clientX-e.boundingRect.left,n.y=event.clientY-e.boundingRect.top,clearTimeout(t);var t=setTimeout(function(){e.context.clearRect(0,0,e.canvasW,e.canvasH),i(e),e.drawBars(n)},1e3/60)})},a.prototype.initData=function(){this.animQuota=0,this.min_data=Math.min.apply(Math,t(c.data)),this.max_data=Math.max.apply(Math,t(c.data))},a.prototype.initContext=function(t){this.boundingRect=t.getBoundingClientRect(),t.nodeType===Node.ELEMENT_NODE&&"CANVAS"===t.nodeName?(this.canvasW=t.width,this.canvasH=t.height,this.context=t.getContext("2d")):n(new Error("Context should be a canvas DOM"))},a.prototype.initOption=function(t){!function e(n){Object.keys(n).forEach(function(t){n[t]&&!o.isObject(n[t])?c[t]=n[t]:o.isObject(n[t])&&e(n[t])})}(t)},a.prototype.initBars=function(){var i=this;this.bars=[];var o=this.areaW/(c.data.length+1)/2,a=1.5*o,r=(this.canvasH-40)/this.tick[1];c.data.forEach(function(t,e){var n=function(){var n=Object.create(null),i=arguments;return s.forEach(function(t,e){n[t]=i[e]}),n}(a+i.yAxis_left,i.canvasH-26,o,-1*t*r);i.bars.push(n),a+=2*o})},a.prototype.caculateScele=function(){this.tick=o.getTick(0<=this.min_data?0:this.min_data,this.max_data),this.context.font="".concat(c.yAxis.font.size," ").concat(c.yAxis.font.size),this.yAxis_left=parseInt(2*this.context.measureText(this.tick[1]).width),this.areaW=this.canvasW-this.yAxis_left},a.prototype.render=function(){this.context.translate(.5,.5),i(this),this.animation()},a.prototype.drawBars=function(n){var i=!1,o=this;o.bars.forEach(function(t,e){i=!!(n&&n.x>=t.x&&n.x<=t.x+t.w&&n.y<=t.y&&n.y>=t.y+t.h),function(t,e,n){t.fillStyle=n?c.bar.style.select:c.bar.style.default,t.fillRect(e.x,e.y,e.w,e.h)}(o.context,t,i),i&&function(t,e,n){var i="".concat(c.labels[n],": ").concat(c.data[n]);t.font="".concat(c.tooltip.font.size,"px ").concat(c.tooltip.font.family);var o=t.measureText(i).width,a=[{x:e.x,y:e.y},{x:e.x+o+20,y:e.y},{x:e.x+o+20,y:e.y+30},{x:e.x,y:e.y+30}];t.beginPath(),t.fillStyle="rgba(0, 0, 0, 0.6)",t.lineJoin="round",t.moveTo(a[0].x+c.tooltip.radius,a[0].y),t.arcTo(a[1].x,a[1].y,a[2].x,a[2].y,c.tooltip.radius),t.arcTo(a[2].x,a[2].y,a[3].x,a[3].y,c.tooltip.radius),t.arcTo(a[3].x,a[3].y,a[0].x,a[0].y,c.tooltip.radius),t.arcTo(a[0].x,a[0].y,a[1].x,a[1].y,c.tooltip.radius),t.fill(),t.fillStyle="#fff",t.textAlign="left",t.textBaseline="middle",t.fillText(i,e.x+10,e.y+15)}(o.context,n,e)})},a.prototype.animation=function(){var t=this.context;if(t.clearRect(0,0,this.canvasW,this.canvasH),t.save(),i(this),this.animQuota-=10,t.rect(0,this.canvasH,this.canvasW,this.animQuota),t.clip(),this.drawBars(),this.animQuota>-1*this.canvasH){var e=this.animation.bind(this);o.requestAnimationFrame()(e)}t.restore()},a});