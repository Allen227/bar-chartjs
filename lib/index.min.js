!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(t=t||self).BarChart=i()}(this,function(){"use strict";function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function t(t){return function(t){if(Array.isArray(t)){for(var i=0,e=new Array(t.length);i<t.length;i++)e[i]=t[i];return e}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var c={data:[],labels:[],margin:{top:30,bottom:30},xAxis:{font:{size:13,family:"Arial",style:"#333"},line:{style:"#333",width:1},tick:{style:"#333",width:1,length:6}},yAxis:{font:{size:13,family:"Arial",style:"#333"},line:{style:"#333",width:1},tick:{style:"#333",width:1,length:6}},guideLine:{style:"#ccc",width:1},bar:{style:{default:"rgba(16, 142, 233, 0.6)",select:"rgb(16, 142, 233)"}},style:{axis:"#aaa",line:"#ccc"},duration:2e3,tooltip:{radius:4,font:{size:14,family:"Arial",style:"rgba(0, 0, 0, 0.6)"}}},s=["x","y","w","h"];function n(t){var i=t.context,e=t.tick,n=t.yAxis_left,o=t.areaW,a=t.areaH;!function(t,i,e,n){t.beginPath(),t.strokeStyle=c.yAxis.line.style,t.lineWidth=c.yAxis.line.width,t.moveTo(i,c.margin.top),t.lineTo(i,n),t.stroke(),t.beginPath(),t.strokeStyle=c.xAxis.line.style,t.lineWidth=c.xAxis.line.width,t.moveTo(i,n),t.lineTo(e+i,n),t.stroke()}(i,n,o,a),function(t,i,e,n){var o=c.labels,a=e/(o.length+1),r=c.xAxis.tick.length;t.beginPath(),t.strokeStyle=c.xAxis.font.style,t.textAlign="center",t.font="".concat(c.xAxis.font.size,"px ").concat(c.xAxis.font.family),t.fillStyle=c.xAxis.font.style;for(var s=1;s<=o.length;s++)t.moveTo(i+s*a,n),t.lineTo(i+s*a,n+r),t.fillText(o[s-1],i+s*a,n+20);t.closePath(),t.stroke()}(i,n,o,a),function(t,i,e,n,o){var a=(o-c.margin.top)/i[3],r=c.yAxis.tick.length;t.textBaseline="middle",t.textAlign="right",t.font="".concat(c.yAxis.font.size,"px ").concat(c.yAxis.font.family),t.fillStyle=c.yAxis.font.style;for(var s=0;s<=i[3];s++)t.beginPath(),t.fillText(i[2]*s,e-10,o-s*a),t.strokeStyle=c.yAxis.tick.style,t.lineWidth=c.yAxis.tick.width,t.moveTo(e-r,o-s*a),t.lineTo(e,o-s*a),t.closePath(),t.stroke(),0!==s&&(t.beginPath(),t.strokeStyle=c.guideLine.style,t.lineWidth=c.guideLine.width,t.moveTo(e,o-s*a),t.lineTo(n+e,o-s*a),t.closePath(),t.stroke())}(i,e,n,o,a)}var o={isObject:function(t){return"object"===i(t)&&"[object Object]"===Object.prototype.toString.call(t)},formatTick:function(){var l=[];return function(t,i,e){if(!arguments.length)return l;!function(t,i,e){var n,o,a,r,s=(i-t)/e,c=Math.log10(s);o=0<=(o=(s/(n=Math.pow(10,parseInt(c))===s?Math.pow(10,parseInt(c)):Math.pow(10,parseInt(c+1)))).toFixed(6))&&o<=.1?.1:.100001<=o&&o<=.2?.2:.200001<=o&&o<=.25?.25:.250001<=o&&o<=.5?.5:1,o*=n,parseInt(t/o)!==t/o&&(t=parseInt(t/o)*o),parseInt(i/o)!==i/o&&(i=(parseInt(i/o)+1)*o),(r=(i-t)/o)<e&&(i+=!(a=e-r)%2?o*parseInt(a/2):o*parseInt(a/2+1),t-=o*parseInt(a/2)),l.push([t,i,o,e])}(t,i,e)}},getSuitableStep:function(t,i){for(var e=this.formatTick(),n=10;5<=n;n--)e(t,i,n);var o,a=e(),r=Number.MAX_VALUE;return a.forEach(function(t,i){t[1]<=r&&(r=t[1],o=i)}),a[o]},getTick:function(t,i){return this.getSuitableStep(t,i)},requestAnimationFrame:function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return window.setTimeout(t,1e3/60)}}};function e(t){throw t}function a(t,i){this instanceof a||e(new Error('BarChart is constructor, should be involed with "new" operator!')),this._init(t,i)}return a.prototype._init=function(t,i){this.initContext(t),this.initOption(i),this.initData(),this.caculateScele(),this.initBars(),this.initEvent(t),this.render()},a.prototype.initEvent=function(t){var i=this,e=Object.create(null);t.addEventListener("mousemove",function(){e.x=event.clientX-i.boundingRect.left,e.y=event.clientY-i.boundingRect.top,clearTimeout(t);var t=setTimeout(function(){i.context.clearRect(0,0,i.canvasW,i.canvasH),n(i),i.drawBars(e)},1e3/60)})},a.prototype.initData=function(){this.animQuota=0,this.min_data=Math.min.apply(Math,t(c.data)),this.max_data=Math.max.apply(Math,t(c.data))},a.prototype.initContext=function(t){this.boundingRect=t.getBoundingClientRect(),t.nodeType===Node.ELEMENT_NODE&&"CANVAS"===t.nodeName?(this.canvasW=t.width,this.canvasH=t.height,this.context=t.getContext("2d")):e(new Error("Context should be a canvas DOM"))},a.prototype.initOption=function(t){!function i(e,n){Object.keys(e).forEach(function(t){e[t]&&!o.isObject(e[t])?n[t]=e[t]:o.isObject(e[t])&&i(e[t],n[t])})}(t,c)},a.prototype.initBars=function(){var n=this;this.bars=[];var o=this.areaW/(c.data.length+1)/2,a=1.5*o,r=(this.areaH-c.margin.top)/this.tick[1];c.data.forEach(function(t,i){var e=function(){var e=Object.create(null),n=arguments;return s.forEach(function(t,i){e[t]=n[i]}),e}(a+n.yAxis_left,n.areaH,o,-1*t*r);n.bars.push(e),a+=2*o})},a.prototype.caculateScele=function(){this.tick=o.getTick(0<=this.min_data?0:this.min_data,this.max_data),this.context.font="".concat(c.yAxis.font.size," ").concat(c.yAxis.font.size),this.yAxis_left=parseInt(2*this.context.measureText(this.tick[1]).width),this.areaW=this.canvasW-this.yAxis_left,this.areaH=this.canvasH-c.margin.bottom},a.prototype.render=function(){this.context.translate(.5,.5),n(this),this.animation()},a.prototype.drawBars=function(e){var n=this,o=-1;n.bars.forEach(function(t,i){e&&e.x>=t.x&&e.x<=t.x+t.w&&e.y<=t.y&&e.y>=t.y+t.h&&(o=i),function(t,i,e){t.fillStyle=e?c.bar.style.select:c.bar.style.default,t.fillRect(i.x,i.y,i.w,i.h)}(n.context,t,!1)}),~o&&function(t,i,e){var n="".concat(c.labels[e],": ").concat(c.data[e]);t.font="".concat(c.tooltip.font.size,"px ").concat(c.tooltip.font.family);var o=t.measureText(n).width,a=[{x:i.x,y:i.y},{x:i.x+o+20,y:i.y},{x:i.x+o+20,y:i.y+30},{x:i.x,y:i.y+30}];t.beginPath(),t.fillStyle="rgba(0, 0, 0, 0.6)",t.lineJoin="round",t.moveTo(a[0].x+c.tooltip.radius,a[0].y),t.arcTo(a[1].x,a[1].y,a[2].x,a[2].y,c.tooltip.radius),t.arcTo(a[2].x,a[2].y,a[3].x,a[3].y,c.tooltip.radius),t.arcTo(a[3].x,a[3].y,a[0].x,a[0].y,c.tooltip.radius),t.arcTo(a[0].x,a[0].y,a[1].x,a[1].y,c.tooltip.radius),t.fill(),t.fillStyle="#fff",t.textAlign="left",t.textBaseline="middle",t.fillText(n,i.x+10,i.y+15)}(n.context,e,o)},a.prototype.animation=function(){var t=this.context;if(t.clearRect(0,0,this.canvasW,this.canvasH),t.save(),n(this),this.animQuota-=10,t.rect(0,this.canvasH,this.canvasW,this.animQuota),t.clip(),this.drawBars(),this.animQuota>-1*this.canvasH){var i=this.animation.bind(this);o.requestAnimationFrame()(i)}t.restore()},a});