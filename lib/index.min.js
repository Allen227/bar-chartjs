!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).BarChart=e()}(this,function(){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function t(t){return function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var y={data:[],labels:[],margin:{top:30,bottom:30},xAxis:{font:{size:13,family:"Arial",style:"#333"},line:{style:"#333",width:1},tick:{style:"#333",width:1,length:6}},yAxis:{font:{size:13,family:"Arial",style:"#333"},line:{style:"#333",width:1},tick:{style:"#333",width:1,length:6}},guideLine:{style:"#ccc",width:1},bar:{style:{default:"rgba(16, 142, 233, 0.6)",select:"rgb(16, 142, 233)"}},style:{axis:"#aaa",line:"#ccc"},duration:500,tooltip:{title:"",style:"rgba(0, 0, 0, 0.6)",height:50,radius:4,mark:{radius:5,style:"rgb(16, 142, 233)"},font:{size:14,family:"Arial",style:"rgba(0, 0, 0, 0.6)"}}},r=["x","y","w","h"];function n(t){var e=t.context,i=t.tick,n=t.phyScale*i[2],o=t.yAxis_left,a=t.areaW,r=t.areaH;!function(t,e,i,n){t.beginPath(),t.strokeStyle=y.yAxis.line.style,t.lineWidth=y.yAxis.line.width,t.moveTo(e,y.margin.top),t.lineTo(e,n),t.stroke(),t.beginPath(),t.strokeStyle=y.xAxis.line.style,t.lineWidth=y.xAxis.line.width,t.moveTo(e,n),t.lineTo(i+e,n),t.stroke()}(e,o,a,r),function(t,e,i,n){var o=y.labels,a=i/(o.length+1),r=y.xAxis.tick.length;t.beginPath(),t.strokeStyle=y.xAxis.font.style,t.textAlign="center",t.font="".concat(y.xAxis.font.size,"px ").concat(y.xAxis.font.family),t.fillStyle=y.xAxis.font.style;for(var s=1;s<=o.length;s++)t.moveTo(e+s*a,n),t.lineTo(e+s*a,n+r),t.fillText(o[s-1],e+s*a,n+20);t.closePath(),t.stroke()}(e,o,a,r),function(t,e,i,n,o,a){var r=y.yAxis.tick.length;t.textBaseline="middle",t.textAlign="right",t.font="".concat(y.yAxis.font.size,"px ").concat(y.yAxis.font.family),t.fillStyle=y.yAxis.font.style;for(var s=0;s<=e[3];s++)t.beginPath(),t.fillText(e[2]*s,i-10,Math.round(a-s*n)),t.strokeStyle=y.yAxis.tick.style,t.lineWidth=y.yAxis.tick.width,t.moveTo(i-r,Math.round(a-s*n)),t.lineTo(i,Math.round(a-s*n)),t.closePath(),t.stroke(),0!==s&&(t.beginPath(),t.strokeStyle=y.guideLine.style,t.lineWidth=y.guideLine.width,t.moveTo(i,Math.round(a-s*n)),t.lineTo(o+i,Math.round(a-s*n)),t.closePath(),t.stroke())}(e,i,o,n,a,r)}var o={isObject:function(t){return"object"===e(t)&&"[object Object]"===Object.prototype.toString.call(t)},formatTick:function(){var c=[];return function(t,e,i){if(!arguments.length)return c;!function(t,e,i){var n,o,a,r,s=(e-t)/i,l=Math.log10(s);o=0<=(o=(s/(n=Math.pow(10,parseInt(l))===s?Math.pow(10,parseInt(l)):Math.pow(10,parseInt(l+1)))).toFixed(6))&&o<=.1?.1:.100001<=o&&o<=.2?.2:.200001<=o&&o<=.25?.25:.250001<=o&&o<=.5?.5:1,o*=n,parseInt(t/o)!==t/o&&(t=parseInt(t/o)*o),parseInt(e/o)!==e/o&&(e=(parseInt(e/o)+1)*o),(r=(e-t)/o)<i&&(e+=!(a=i-r)%2?o*parseInt(a/2):o*parseInt(a/2+1),t-=o*parseInt(a/2)),c.push([t,e,o,i])}(t,e,i)}},getSuitableStep:function(t,e){for(var i=this.formatTick(),n=10;5<=n;n--)i(t,e,n);var o,a=i(),r=Number.MAX_VALUE;return a.forEach(function(t,e){t[1]<=r&&(r=t[1],o=e)}),a[o]},getTick:function(t,e){return this.getSuitableStep(t,e)},requestAnimationFrame:function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return window.setTimeout(t,1e3/60)}}};function i(t){throw t}function a(t,e){this instanceof a||i(new Error('BarChart is constructor, should be involed with "new" operator!')),this._init(t,e)}return a.prototype._init=function(t,e){this.initContext(t),this.initOption(e),this.initData(),this.caculateScele(),this.initBars(),this.initEvent(t),this.render()},a.prototype.initEvent=function(t){var e=this,i=Object.create(null);t.addEventListener("mousemove",function(){i.x=event.clientX-e.boundingRect.left,i.y=event.clientY-e.boundingRect.top,clearTimeout(t);var t=setTimeout(function(){e.context.clearRect(0,0,e.canvasW,e.canvasH),n(e),e.drawBars(i)},1e3/60)})},a.prototype.initData=function(){this.animQuota=0,this.min_data=Math.min.apply(Math,t(y.data)),this.max_data=Math.max.apply(Math,t(y.data))},a.prototype.initContext=function(t){this.boundingRect=t.getBoundingClientRect(),t.nodeType===Node.ELEMENT_NODE&&"CANVAS"===t.nodeName?(this.canvasW=t.width,this.canvasH=t.height,this.context=t.getContext("2d")):i(new Error("Context should be a canvas DOM"))},a.prototype.initOption=function(t){!function e(i,n){Object.keys(i).forEach(function(t){i[t]&&!o.isObject(i[t])?n[t]=i[t]:o.isObject(i[t])&&e(i[t],n[t])})}(t,y)},a.prototype.initBars=function(){var n=this;this.bars=[],this.phyScale=(this.areaH-y.margin.top)/this.tick[1];var o=this.areaW/(y.data.length+1)/2,a=1.5*o;y.data.forEach(function(t,e){var i=function(){var i=Object.create(null),n=arguments;return r.forEach(function(t,e){i[t]=n[e]}),i}(a+n.yAxis_left,n.areaH,o,-1*t*n.phyScale);n.bars.push(i),a+=2*o})},a.prototype.caculateScele=function(){this.tick=o.getTick(0<=this.min_data?0:this.min_data,this.max_data),this.context.font="".concat(y.yAxis.font.size," ").concat(y.yAxis.font.size),this.yAxis_left=parseInt(2*this.context.measureText(this.tick[1]).width),this.areaW=this.canvasW-this.yAxis_left,this.areaH=this.canvasH-y.margin.bottom},a.prototype.render=function(){this.context.translate(.5,.5),n(this),this.animation()},a.prototype.drawBars=function(i){var n=this,o=-1;n.bars.forEach(function(t,e){i&&i.x>=t.x&&i.x<=t.x+t.w&&i.y<=t.y&&i.y>=t.y+t.h&&(o=e),function(t,e,i){t.fillStyle=i?y.bar.style.select:y.bar.style.default,t.fillRect(e.x,e.y,e.w,e.h)}(n.context,t,!1)}),~o&&function(t,e,i){var n=y.tooltip.mark.radius,o="".concat(y.tooltip.title).concat(y.data[i]);t.font="".concat(y.tooltip.font.size,"px ").concat(y.tooltip.font.family);var a=t.measureText(o).width,r=t.measureText(y.labels[i]).width,s=r<a?a:r;s+=3*n;var l=y.tooltip.radius,c=y.tooltip.height,h=e.x+10,f=e.y+10,u=[{x:h,y:f},{x:h+s+12,y:f},{x:h+s+12,y:f+c},{x:h,y:f+c}];t.beginPath(),t.fillStyle=y.tooltip.style,t.lineJoin="round",t.moveTo(u[0].x+y.tooltip.radius,u[0].y),t.arcTo(u[1].x,u[1].y,u[2].x,u[2].y,l),t.arcTo(u[2].x,u[2].y,u[3].x,u[3].y,l),t.arcTo(u[3].x,u[3].y,u[0].x,u[0].y,l),t.arcTo(u[0].x,u[0].y,u[1].x,u[1].y,l),t.fill(),t.beginPath(),t.fillStyle="#fff",t.textAlign="left",t.textBaseline="middle",t.fillText(y.labels[i],h+6,f+.85*c/3),t.fillText(o,h+6+3*n,f+2.1*c/3),t.closePath(),t.stroke(),t.beginPath(),t.fillStyle=y.tooltip.mark.style,t.arc(h+6+n,f+2*c/3,n,0,2*Math.PI),t.fill()}(n.context,i,o)},a.prototype.animation=function(){var t=this.context,e=this.max_data*this.phyScale/(.001*y.duration*60);if(t.clearRect(0,0,this.canvasW,this.canvasH),t.save(),n(this),this.animQuota-=e,t.rect(0,this.canvasH-y.margin.bottom,this.canvasW,this.animQuota),t.clip(),this.drawBars(),this.animQuota>-1*this.max_data*this.phyScale){var i=this.animation.bind(this);o.requestAnimationFrame()(i)}t.restore()},a});